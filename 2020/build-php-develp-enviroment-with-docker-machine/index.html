<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="ColaChen">
  
  
  
  <link rel="prev" href="https://hdwyz.com/2020/basic-usage-of-git/" />
  <link rel="next" href="https://hdwyz.com/2020/build-ssr-with-your-vps/" />
  <link rel="canonical" href="https://hdwyz.com/2020/build-php-develp-enviroment-with-docker-machine/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <link href="//use.fontawesome.com/releases/v5.9.0/css/all.css" rel="stylesheet">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           MacOS 搭建 PHP 开发环境 | 可乐橙
       
  </title>
  <meta name="title" content="MacOS 搭建 PHP 开发环境 | 可乐橙">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/hdwyz.com"
    },
    "articleSection" : "posts",
    "name" : "MacOS 搭建 PHP 开发环境",
    "headline" : "MacOS 搭建 PHP 开发环境",
    "description" : "macOS 搭建 PHP 开发环境： 安装 docker toolbox docker-machine -v 确认已经安装并查看当前版本 docker-machine ls 查看当前可用主机 docker-machine create \x26ndash;driver virtualbox default 创建一个基本主机 若打开 VT-X\/AMD-X 后仍提示，使用跳过检测的命令：",
    "inLanguage" : "zh-CN",
    "author" : "ColaChen",
    "creator" : "ColaChen",
    "publisher": "ColaChen",
    "accountablePerson" : "ColaChen",
    "copyrightHolder" : "ColaChen",
    "copyrightYear" : "2020",
    "datePublished": "2020-02-04 04:01:21 \x2b0800 CST",
    "dateModified" : "2020-02-04 04:01:21 \x2b0800 CST",
    "url" : "https:\/\/hdwyz.com\/2020\/build-php-develp-enviroment-with-docker-machine\/",
    "wordCount" : "1777",
    "keywords" : [  "可乐橙"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://hdwyz.com">可乐橙</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://hdwyz.com">可乐橙</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">MacOS 搭建 PHP 开发环境</h1>
        <div class="post-meta">
                
            <i class="far fa-folder-open"></i>
            <span class="post-category">
                <a href="https://hdwyz.com/categories/%E5%85%A5%E9%97%A8/">
                    入门
                </a>
                
            </span>
            <span class="post-time">
                <i class="far fa-calendar-alt"></i>
                <time datetime=2020-02-04 itemprop="datePublished">
                    2020-02-04
                </time>
            </span>
            <i class="far fa-file-word"></i>
            <span class="post-word-count">
                1777 字
            </span>
            <i class="far fa-clock"></i>
            <span class="more-meta">
                4 分钟
            </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h3 id="macos-搭建-php-开发环境">macOS 搭建 PHP 开发环境：</h3>
<ol>
<li>
<p>安装 docker toolbox</p>
</li>
<li>
<p>docker-machine -v  确认已经安装并查看当前版本</p>
</li>
<li>
<p>docker-machine ls  查看当前可用主机</p>
</li>
<li>
<p>docker-machine create &ndash;driver virtualbox default  创建一个基本主机
若打开 VT-X/AMD-X 后仍提示，使用跳过检测的命令：
docker-machine create default &ndash;virtualbox-no-vtx-check</p>
</li>
<li>
<p>docker-machine start default  启动虚拟机</p>
</li>
<li>
<p>docker-machine env default  查看当前主机配置</p>
</li>
<li>
<p>eval $(docker-machine env default)  根据默认配置设置目标主机</p>
</li>
<li>
<p>docker search mysql  在 docker 仓库中搜索 mysql</p>
</li>
<li>
<p>docker pull mysql:5.7  拉取 mysql 5.7 版本</p>
</li>
<li>
<p>docker run &ndash;name mysql -p 13306:3306 -v /var/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7  运行 mysql</p>
</li>
<li>
<p>navicat 使用 192.168.99.100 13306 root root 连接到 docker-mysql</p>
</li>
<li>
<p>docker pull daocloud.io/library/php:7.2.16-fpm  安装 php-fpm</p>
</li>
<li>
<p>vim Dockerfile，写入</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">FROM daocloud.io/library/php:7.2.16-fpm
RUN apt-get update <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> apt-get install -y libmemcached-dev zlib1g-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> pecl install igbinary <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> pecl install redis-4.0.0 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-enable redis <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> apt-get install -y libfreetype6-dev libjpeg62-turbo-dev libpng-dev <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-install -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span> mysqli <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-install -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span> pdo_mysql <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#f92672">&amp;&amp;</span> docker-php-ext-install -j<span style="color:#66d9ef">$(</span>nproc<span style="color:#66d9ef">)</span> gd
</code></pre></div></li>
<li>
<p>dock er build -t php72:ext  构建镜像</p>
</li>
<li>
<p>docker run -it php72:ext php -m  查看 php72:ext 中的扩展</p>
</li>
<li>
<p>docker run &ndash;name php -v /www:/usr/share/nginx/html -d php72:ext  创建 php 实例</p>
</li>
<li>
<p>docker pull nginx  拉取 nginx 镜像</p>
</li>
<li>
<p>docker run &ndash;name nginx-test -d nginx:latest  运行 nginx 容器</p>
</li>
<li>
<p>docker cp nginx-test:/etc/nginx /var/nginx  将容器中的配置文件复制到宿主主机中 ❌</p>
<p>nginx 的配置文件路径不正确：</p>
</li>
</ol>
<p><del>靠这个解决不掉了</del>  深入学习 docker 后再来解决</p>
<hr>
<h4 id="docker-machine-基本命令">Docker-machine 基本命令</h4>
<ul>
<li>docker-machine ls  列出可用的机器</li>
<li>docker-machine create &ndash;driver virtualbox <!-- raw HTML omitted -->  创建机器</li>
<li>docker-machine ip <!-- raw HTML omitted -->  查看机器的ip</li>
<li>docker-machine stop <!-- raw HTML omitted -->  停止机器</li>
<li>docker-machine start <!-- raw HTML omitted -->  启动机器</li>
<li>docker-machine ssh <!-- raw HTML omitted -->  进入机器</li>
</ul>
<hr>
<h4 id="docker-基本命令">Docker 基本命令</h4>
<ul>
<li>docker image ls  列出当前 docker 内的镜像</li>
<li>docker image rm <!-- raw HTML omitted --> 根据 id 删除镜像</li>
<li>docker container ls -a  列出所有容器</li>
<li>docker container rm <!-- raw HTML omitted --> 根据 id 删除静止状态的容器</li>
<li>dicker container rm <!-- raw HTML omitted --> -f  强制删除容器</li>
<li>docker container prune  清除所有静止状态的容器</li>
<li>docker run  新建并启动容器</li>
<li>docker container start  启动一个已经终止的容器</li>
</ul>
<hr>
<h3 id="用-valet-搭建-laravel-环境再适配其他的-php-框架">用 valet 搭建 laravel 环境，再适配其他的 PHP 框架</h3>
<ol>
<li>
<p>brew install php  安装 PHP</p>
</li>
<li>
<p>安装 <a href="https://getcomposer.org/">Composer</a></p>
</li>
<li>
<p>composer global require laravel/valet  安装 Valet</p>
</li>
<li>
<p>将 ~/.composer/vendor/bin 添加到系统环境 PATH</p>
</li>
<li>
<p>valet install  配置和安装 Valet 和 DnsMasq</p>
</li>
<li>
<p>ping foobar.test  尝试 ping 任意一个 .test 域名，查看是否有响应</p>
</li>
<li>
<p>valet use php@版本号  切换 php 版本号，如果不存在则会自动下载安装</p>
</li>
<li>
<p>composer global update  升级 valet，升级后必须使用 valet install 升级配置文件</p>
</li>
<li>
<p>升级到 valet 2.0</p>
<pre><code class="language-shell " data-lang="shell ">valet stop
valet uninstall
composer global require laravel/valet
valet install
valet restart
</code></pre></li>
<li>
<p>composer create-project &ndash;prefer-dist laravel/laravel lrv  使用 composer 安装 laravel</p>
</li>
<li>
<p>草，本地 mysql 又运行不起来</p>
</li>
<li>
<p>按照下面的安装好 mysql</p>
</li>
<li>
<p>由于 valet 默认只支持 laravel，如果需要支持其他 php 框架则需要添加相应的驱动文件：
<a href="https://github.com/huanghua581/ThinkPHP5ValetDriver">ThinkPHP5 Valet Driver</a></p>
</li>
<li>
<p>使用 valet 添加站点</p>
</li>
</ol>
<hr>
<h4 id="mysql">mysql</h4>
<ul>
<li>macOS 使用 brew install mysql 安装的是高版本的 mysql，由于公司使用 mysql 5.5 部分功能已经在 8.0 版本弃用，所以需要安装 5.7 版本 mysql</li>
<li>brew install <a href="mailto:mysql@5.7">mysql@5.7</a>  安装 mysql 5.7</li>
<li>mysql.server start  启动 mysql</li>
<li>报错，ERROR! The server quit without updating PID file (/usr/local/var/mysql/*.local.pid).
进入 /usr/local/var/mysql 目录，看到一个 *.local.err 文件，打开找到 error 提示，并解决</li>
<li>mysql &ndash;verbose &ndash;help | grep my.cnf  查看 mysql 加载的配置文件路径，我的是 /usr/local/etc/my.cnf</li>
<li>将 mysql 添加到环境中方便终端使用，路径是 export PATH=$PATH:/usr/local/mysql/bin</li>
<li>使用枚举型 set/enum 时要注意默认值必须在枚举值中存在，否则保存或更新会报错：
[ERR] 1265 - Data truncated for column ‘xxx’ at row 1</li>
</ul>
<p><em><!-- raw HTML omitted -->以上舍弃，新手入门有方便现成的安装包就别去整 brew<!-- raw HTML omitted --></em></p>
<ol>
<li>
<p><a href="https://downloads.mysql.com/archives/community/">https://downloads.mysql.com/archives/community/</a>  官网下载 dmg 文件</p>
</li>
<li>
<p>安装，过程中记住弹窗提示的密码，否则：</p>
</li>
<li>
<p>没记住密码，很好，先去系统偏好设置，找到 mysql，点开，停止运行</p>
</li>
<li>
<p>sudo /usr/local/mysql/bin/mysqld_safe &ndash;skip-grant-tables  安全模式启动 mysql</p>
</li>
<li>
<p>打开另一个终端</p>
</li>
<li>
<p>sudo /usr/local/mysql/bin/mysql -u root  进入 mysql</p>
</li>
<li>
<p>UPDATE mysql.user SET authentication_string=PASSWORD(&lsquo;新密码&rsquo;) WHERE User='root&rsquo;;  设置新密码</p>
</li>
<li>
<p>FLUSH PRIVILEGES;  刷新</p>
</li>
<li>
<p>\q  退出</p>
</li>
<li>
<p>重启 mysql。你会发现现在系统偏好设置没办法停止运行，终端命令也不管用。打开活动监视器，找到 mysqld，强制停止</p>
</li>
<li>
<p>系统偏好设置，找到 mysql，点开，运行</p>
</li>
<li>
<p>My.cnf 中添加</p>
<pre><code>character_set_server=utf8mb4
collation-server=utf8mb4_unicode_ci
</code></pre><p>保证在数据库中创建数据表时默认 utf8mb4 类型</p>
</li>
</ol>
<p>好的你的 <a href="mailto:mysql@5.7">mysql@5.7</a> 在经历一系列的磨难后终于可以运行了。</p>
<hr>
<h4 id="valet-基本命令">Valet 基本命令：</h4>
<ul>
<li>valet park  将当前文件夹设置为站点，用 目录名.test 访问</li>
<li>valet link app-name  将单个项目设置为站点，用 app-name.test 访问</li>
<li>valet share  生成公共 URL 将站点分享</li>
<li>valet paths  查看所有路径</li>
<li>valet forget  删除当前路径</li>
<li>valet log  从 Valet 的服务中查看日志</li>
<li>valet trust  为 Brew 和 Valet 添加文件修改权限使 Valet 输入命令的时候不需要输入密码</li>
<li>valet start</li>
<li>valet stop</li>
<li>valet restart</li>
<li>valet uninstall</li>
</ul>
<hr>
<h4 id="项目部署到服务器">项目部署到服务器</h4>
<ul>
<li>git clone  从远程仓库拉取代码</li>
<li>git checkout -b dev(本地分支名称) origin/dev(远程分支名称)  在服务器上创建相应的本地分支</li>
<li>修改配置文件 env 已经数据库文件 database.php</li>
<li>项目文件夹权限 777</li>
<li>宝塔面板中，网站目录取消“防跨站攻击”，添加伪静态规则</li>
</ul>
<hr>
<h4 id="其他命令">其他命令</h4>
<ul>
<li>
<p>shell 环境配置：~/.bash_profile</p>
</li>
<li>
<p>添加 laravel：~/.composer/vendor/bin/laravel</p>
</li>
<li>
<p>修改 hosts：sudo vi /etc/hosts</p>
</li>
<li>
<p>正则表达式查看系统进程：ps -ef | grep nginx</p>
</li>
<li>
<p>brew config  查看 brew 配置文件，如果不是国内源，进行替换：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 替换homebrew默认源（源代码仓库）</span>
cd <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>brew --repo<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
git remote set-url origin git://mirrors.ustc.edu.cn/brew.git
<span style="color:#75715e"># 替换homebrew-core源（核心软件仓库）</span>
cd <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>brew --repo<span style="color:#66d9ef">)</span><span style="color:#e6db74">/Library/Taps/homebrew/homebrew-core</span><span style="color:#e6db74">&#34;</span>
git remote set-url origin git://mirrors.ustc.edu.cn/homebrew-core.git
<span style="color:#75715e"># 替换homebrew-bottles（预编译二进制软件包）（zsh 用户）</span>
echo <span style="color:#e6db74">&#39;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#39;</span> &gt;&gt; ~/.zshrc
source ~/.zshrc
</code></pre></div></li>
<li>
<p>终端使用 ssh 登陆远程服务器：ssh -p port user@ip，然后输入密码</p>
</li>
<li>
<p>php 7.3.8 版本在 macOS Catalina 中有个 bug，就是没有自带 zip-extension，所以无法使用 laravel new 命令来安装一个 laravel 项目。解决方案是  <del>安装 php 7.3 或者 php 7.4</del>  使用 git clone 直接从 github 上下载</p>
</li>
</ul>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>ColaChen </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://hdwyz.com/2020/build-php-develp-enviroment-with-docker-machine/>https://hdwyz.com/2020/build-php-develp-enviroment-with-docker-machine/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://hdwyz.com">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://hdwyz.com/2020/basic-usage-of-git/" class="prev" rel="prev" title="使用Git进行版本控制"><i class="iconfont icon-left"></i>&nbsp;使用Git进行版本控制</a>
         
        
        <a href="https://hdwyz.com/2020/build-ssr-with-your-vps/" class="next" rel="next" title="VPS - 酸酸乳基本使用姿势">VPS - 酸酸乳基本使用姿势&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2020 - 2020</span>
        
        <span class="with-love">
    	   <i class="iconfont icon-love"></i> 
        </span>
        
        <span class="author" itemprop="copyrightHolder"><a href="https://hdwyz.com">ColaChen</a> | </span> 
        

        
        <a href="http://www.miibeian.gov.cn/" target="_blank" rel="external nofollow">浙ICP备20008126号-1 </a> |
        
		<span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
